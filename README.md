# Telegram Local Archiver

A high-performance, offline-first Telegram channel archiver with a web dashboard. Built for privacy, speed, and simplicity.

## Key Features

- **Real-Time Archiving**: Instantly captures messages, media, and files from monitored channels.
- **Offline-First**: All data is stored locally in an optimized SQLite database (wal mode enabled).
- **Premium Web Dashboard**: A responsive, dark-mode web interface (port 8080) that mimics the native Telegram UX.
- **Privacy Focused**: Supports SOCKS5/HTTP proxies and stores session data securely.
- **Smart Deduplication**: Advanced logic prevents duplicate downloads even if files are manually deleted.
- **Zero-Dependency Server**: Uses Python's built-in http.server â€” no heavy web frameworks required.

---

## Installation

### Prerequisites

- Python 3.8+
- A valid Telegram account (Phone Number)

### Quick Start

1. **Clone the Repository**

   ```bash
   git clone https://github.com/danielhadian/LocalGram.git
   cd LocalGram
   ```

2. **Setup Virtual Environment (Recommended)**

   ```bash
   python3 -m venv venv
   source venv/bin/activate  # Windows: venv\Scripts\activate
   ```

3. **Install Dependencies**
   ```bash
   pip install -r requirements.txt
   ```

---

## Configuration

Edit the `config.yaml` file in the root directory:

```yaml
# 1. Telegram Credentials (my.telegram.org)
# You can get your own, or use these public sample credentials:
# api_id: 17349
# api_hash: "344583e45741c457fe1862106095a5eb"

api_id: YOUR_API_ID
api_hash: "YOUR_API_HASH"
session_name: "my_session"

# 2. Channels to Archive (Usernames or Invite Links)
channels:
  - "telegram"
  - "durov"
  - "SpaceX"

# 3. Media Download Settings
download_media: true
media_types:
  - "photo" # Download images
  - "video" # Download videos
  # - "document" # Uncomment to download files

# 4. Proxy Settings
proxy:
  enabled: true
  type: "SOCKS5"
  host: "127.0.0.1"
  port: 10808
```

---

## Usage

### 1. Start the System

Run the main script. On the first run, you will be asked to log in via terminal.

```bash
python3 main.py
```

### 2. Access the Dashboard

Open your browser and navigate to:
http://localhost:8080

- **View Archives**: Browse channels and messages chronologically.
- **Clear Data**: Use the "Clear Data" button in the header to instantly wipe the database and downloaded files (useful for testing).

---

## Architecture Overview

The system runs two concurrent threads:

1.  **The Archiver (Async IO)**:
    - Connects to Telegram using Telethon.
    - Listens for NewMessage events.
    - Downloads media to `downloads/<channel>/`.
    - Saves metadata to `archive.db`.

2.  **The Web Server (Threaded)**:
    - Runs Python's http.server.
    - Serves static HTML/CSS files generated by Jinja2.
    - Exposes API endpoints (e.g., `/api/clear_data`).

---

## Troubleshooting

**Q: Connection Failed / Long Polling?**
A: Ensure your Proxy settings in `config.yaml` match your local proxy (e.g., v2ray/sing-box).

**Q: "Address already in use" Error?**
A: The port 8080 is busy. The script now handles port reuse, but you can also kill the process using `pkill -f "python3 main.py"`.

**Q: How do I reset everything?**
A: Click the **Clear Data** button on the dashboard, or manually delete `archive.db` and the `downloads/` folder.

---

## License

MIT License. Free to use and modify.
